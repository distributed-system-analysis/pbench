#!/bin/bash

dir=$(dirname $0)
let sts=0

$dir/agent/bench-scripts/unittests > /var/tmp/agent.bench-scripts.out 2>&1 < /dev/null &
bpid=$!
$dir/agent/tool-scripts/postprocess/unittests > /var/tmp/agent.tool-scripts.pp.out 2>&1 < /dev/null &
tpid=$!
$dir/agent/util-scripts/unittests > /var/tmp/agent.util-scripts.out 2>&1 < /dev/null &
upid=$!
$dir/server/bin/unittests --parallel > /var/tmp/server.out 2>&1 < /dev/null &
spid=$!

echo "+++ Agent bench-scripts Unit Tests +++"
echo ""
wait $bpid
let sts=sts+$?
cat /var/tmp/agent.bench-scripts.out && rm /var/tmp/agent.bench-scripts.out
echo ""
echo "--- Agent bench-scripts Unit Tests ---"
echo ""
echo ""
echo ""
echo "+++ Agent tool-scripts/postprocess Unit Tests +++"
echo ""
wait $tpid
let sts=sts+$?
cat /var/tmp/agent.tool-scripts.pp.out && rm /var/tmp/agent.tool-scripts.pp.out
echo ""
echo "--- Agent tool-scripts/postprocess Unit Tests ---"
echo ""
echo ""
echo ""
echo "+++ Agent util-scripts Unit Tests +++"
echo ""
wait $upid
let sts=sts+$?
cat /var/tmp/agent.util-scripts.out && rm /var/tmp/agent.util-scripts.out
echo ""
echo "--- Agent util-scripts Unit Tests ---"
echo ""
echo ""
echo ""
echo "+++ Server Unit Tests +++"
echo ""
wait $spid
let sts=sts+$?
cat /var/tmp/server.out && rm /var/tmp/server.out
echo ""
echo "--- Server Unit Tests ---"

if [ $sts -gt 0 ]; then
    echo "Unit tests FAILED"
fi
exit $sts
